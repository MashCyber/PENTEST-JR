###########################################################
# Mount S3 bucket to File System
echo "[+] Mount S3 bucket to File System .... "
###########

#0. PREFERABLY RUN AS ROOT
echo "[+] Move to ROOT user.. " 
sudo su

# 1. Install s3-mount package (DEBIAN)
####################################
echo "[+] Installing s3-mount package (UBUNTU)..."
sudo wget https://s3.amazonaws.com/mountpoint-s3-release/latest/x86_64/mount-s3.deb
sudo apt-get install -y ./mount-s3.deb
mount-s3 --version

# 2. Create mountpoint dir on the filesystem
##########################################
echo "[+] Create S3 mountpoint if none-exits/ignore If exits..."
echo "[+] mkdir -p /mnt/<NAME> "
read -p '[+] Mount Directory: e.g /mnt/s3 ' MOUNT_DIR
sudo mkdir -p $BUCKET_NAME

# 3. Install aws cli and create mounting profile
##############################################
sudo echo "[+] Installing AWS CLI..."
sudo curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
sudo apt install unzip -y
sudo unzip awscliv2.zip
sudo ./aws/install
read -p '[+] Aws User Profile: ' USER_PROFILE
sudo aws configure --profile $USER_PROFILE

# 4. Create Bash script to Mount s3 bucket to filesystem mountpoint
#################################################################
echo "[+] mount-s3 -l <./mount.log> --profile <PROFILE> <BUCKET_NAME> <MOUNT DIR>"
read -p '[+] Bucket Name: ' BUCKET_NAME
touch s3-mount.log
sudo mount-s3 -l s3-mount.log --profile $USER_PROFILE $BUCKET_NAME $MOUNT_DIR
